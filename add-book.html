<!-- 
  Bug 0 - 30/11/2021 - Added a close button at the ends of Reportoire. 
  Bug 1 - 30/11/2021 - Changed data array to Object and Iterating over it. Removing need for ID's to be consecutive
  Bug 2 - 30/11/2021 - Added id's to the footer
  Bug 6 - 31/11/2021 - Added Footer to Add book page. Provided functionality to fetch data from the database and display it upon click on footer links of Book Ids.
  Bug 7 - 31/11/2021 - Removed Scrollbar from Add Book page.
  Bug 8 - 31/11/2021 - Added custom Scrollbar
  Bug 10 - Added moving background image with books
  Bug 11 -04/12/2021 - Make site responsive
  Bug 12 - 04/12/2021 - Added Bootstrap and jquery dist files to the project.
  Bug 13 - 04/12/2021 - Toastr messages were coming white due to Bootstrap interference. Moved after the Bootstrap files.
  Bug 14 - 04/12/2021 - Added Toastr dist files to the project.
 -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <!--Bug 11 above line-->
    <title>AddBook</title>
    <!-- <link
      href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/css/bootstrap.min.css"
      rel="stylesheet"
    /> -->
    <!-- Bug 12 
      <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    /> -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"
    />

    <!-- <link
      href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.min.css"
      rel="stylesheet"
    /> -->
    <link rel="stylesheet" href="assets/bootstrap.min.css" />
    <!-- Bug 14 starts-->
    <!-- Bug 13  -->
    <!-- <link
      href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css"
      rel="stylesheet"
    /> -->
    <link rel="stylesheet" href="assets/toastr.min.css" />
    <!-- Bug 14 ends-->
    <!--Bug 12 above line-->
    <!-- Toastr Library Ends -->
    <link rel="stylesheet" href="shared.css" />
    <link rel="stylesheet" href="add-book.css" />
    <!-- <script>
      window.myVar = '{{ env(MY_VAR) }}';
     </script> -->
  </head>
  <body class="scrollbar">
    <!-- Bug 7 -->
    <header id="header">
      <div id="page-logo">
        <a href="/index.html">Library</a>
      </div>
      <nav>
        <ul>
          <li><a href="/">Home</a></li>
          <li>
            <a href="https://contact-ekansh.herokuapp.com/">Contact Us</a>
          </li>
          <li><a href="https://github.com/CAPTAINCOBRA">About</a></li>
        </ul>
      </nav>
    </header>
    <!-- <form class="row p-5"> -->
    <div class="form-container">
      <div class="mb-3 col-5 pair form-floating col-sm-5 col-lg-10 col-md-7">
        <input
          required
          placeholder="Title"
          class="form-control form-control-sm"
          type="text"
          id="Titlebox"
        />
        <label class="form-label">Title</label>
      </div>
      <div class="mb-3 col-5 pair form-floating col-sm-5 col-lg-10 col-md-7">
        <input
          required
          placeholder="Author"
          class="form-control"
          type="text"
          id="Authorbox"
        />
        <label class="form-label">Author</label>
      </div>
      <div class="mb-3 col-5 pair form-floating col-sm-5 col-lg-10 col-md-7">
        <input
          required
          placeholder="Genre"
          class="form-control"
          type="text"
          id="Genrebox"
        />
        <label class="form-label">Genre</label>
      </div>
      <div class="mb-3 col-5 pair form-floating col-sm-5 col-lg-10 col-md-7">
        <input
          required
          placeholder="Image"
          class="form-control"
          type="url"
          id="Imagebox"
        />
        <label class="form-label">Image</label>
      </div>
      <div class="mb-3 col-5 pair form-floating col-sm-5 col-lg-10 col-md-7">
        <input
          required
          placeholder="Id"
          class="form-control"
          type="number"
          id="Idbox"
        />
        <label class="form-label">Id</label>
        <!-- <div class="invalid-id small"> //Bug 1 - Removed this div
          Please don't change the id while adding.
        </div> -->
      </div>
      <div class="mb-3 col-5 pair form-floating col-sm-5 col-lg-10 col-md-7">
        <textarea
          required
          placeholder="Description"
          rows="4"
          class="form-control"
          type="text"
          id="Descbox"
          style="height: auto"
        ></textarea>

        <label class="form-label">Description</label>
      </div>
      <div class="buttonTray">
        <button id="instBtn" class="btn btn-success col-5 btn-x" type="submit">
          Add
        </button>
        <button id="fetchBtn" class="btn btn-primary col-5 btn-x" type="submit">
          Fetch
        </button>
        <button
          id="updateBtn"
          class="btn btn-warning col-5 btn-x"
          type="submit"
        >
          Update
        </button>
        <button id="deleteBtn" class="btn btn-danger col-5 btn-x" type="submit">
          Delete
        </button>
      </div>
      <!-- <button id="instBtn" class="btn btn-primary col-2 mx-auto" formaction="/">
        Home
      </button> -->
    </div>
    <!-- </form> -->

    <!-- Bug 6 starts  -->
    <footer id="footer">
      <ul id="footer-ul">
        <li>
          <a href="https://www.instagram.com">
            <img src="images/icons/insta.png" alt="Instagram logo"
          /></a>
        </li>
        <li>
          <a href="https://www.facebook.com">
            <img src="images/icons/facebook.png" alt="Facebook logo"
          /></a>
        </li>
      </ul>
    </footer>
    <!-- Bug 6 ends -->
    <!--Bug 12 Below-->
    <script src="./assets/jquery-3.5.1.min.js"></script>
    <script type="module">
      const db = "https://librar-server.herokuapp.com/api";
      //------------------References---------------------------------------
      var titlebox = document.getElementById("Titlebox");
      var authorbox = document.getElementById("Authorbox");
      var imagebox = document.getElementById("Imagebox");
      var descbox = document.getElementById("Descbox");
      var idbox = document.getElementById("Idbox");
      var genrebox = document.getElementById("Genrebox");

      var instBtn = document.getElementById("instBtn");
      var fetchBtn = document.getElementById("fetchBtn");
      var updateBtn = document.getElementById("updateBtn");
      var deleteBtn = document.getElementById("deleteBtn");

      //-------------------INSERT Data -------------------------------------------------

      function InsertData() {
        try {
          let idValue = idbox.value;
          if (idValue == "" || idValue == undefined || idValue == null) {
            alert("Please enter the ID 101!");
            return;
          }
        } catch (error) {
          console.log(Error);
        }

        try {
          // fetch("http://localhost:5000/api/book/create", {
          fetch(`${db}/book/create`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              name: titlebox.value,
              author: authorbox.value,
              image: imagebox.value,
              description: descbox.value,
              id: idbox.value,
              genre: genrebox.value,
            }),
          })
            // .then((res) => res.json())
            .then((res) => {
              console.log(res);
              if (res.status == 200) {
                alert("Book added successfully!");
                // window.location.reload();
                authorbox.value = "";
                titlebox.value = "";
                imagebox.value = "";
                descbox.value = "";
                idbox.value = "";
                genrebox.value = "";
                toastr.success(
                  "The book has been added successfully!.",
                  "Success"
                );
              } else {
                const data = res.json();
                data.then((data) => {
                  alert(
                    "Data for this ID already exists! \n Book name is - " +
                      data.foundBook.name
                  );
                });
              }
            });
        } catch (error) {
          console.log("Encountered an error!");
          console.log(error);
        }
      }

      //-------------------FETCH Data -------------------------------------------------
      function fetchData() {
        try {
          let idValue = idbox.value;
          if (idValue == "" || idValue == undefined || idValue == null) {
            alert("Please enter the ID 102!");
            return;
          }
        } catch (error) {
          console.log(Error);
        }

        try {
          // fetch("http://localhost:5000/api/book/" + idbox.value)
          fetch(`${db}/book/` + idbox.value)
            .then((res) => res.json())
            .then((data) => {
              if (data.error) {
                alert("No book found with this ID!");
              } else {
                console.log("This is the Mongo ID Data - ", data);
                titlebox.value = data.name;
                authorbox.value = data.author;
                imagebox.value = data.image;
                descbox.value = data.description;
                genrebox.value = data.genre;
                toastr.info("Book fetched successfully!", "Fetched!");
              }
            });
        } catch (error) {
          console.log("Error in fetching data from MongoDB");
        }
      }

      //-------------------UPDATE Data -------------------------------------------------
      function updateData() {
        try {
          let idValue = idbox.value;
          if (idValue == "" || idValue == undefined || idValue == null) {
            alert("Please enter the ID 103!");
            return;
          }
        } catch (error) {
          console.log(Error);
        }

        try {
          // fetch("http://localhost:5000/api/book/" + idbox.value, {
          fetch(`${db}/book/` + idbox.value, {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              name: titlebox.value,
              author: authorbox.value,
              image: imagebox.value,
              description: descbox.value,
              id: idbox.value,
              genre: genrebox.value,
            }),
          })
            .then((res) => res.json())
            .then((data) => {
              console.log("This is the Mongo ID Data - ", data);
              toastr.warning("The book has been updated.", "Updated");
              titlebox.value = "";
              authorbox.value = "";
              imagebox.value = "";
              descbox.value = "";
              idbox.value = "";
              genrebox.value = "";
            });
        } catch (error) {
          console.log("Error in updating data from MongoDB");
        }
      }

      //-------------------DELETE Data -------------------------------------------------
      function deleteData() {
        try {
          let idValue = idbox.value;
          if (idValue == "" || idValue == undefined || idValue == null) {
            alert("Please enter the ID 104!");
            return;
          }
        } catch (error) {
          console.log(Error);
        }

        try {
          // fetch("http://localhost:5000/api/book/" + idbox.value, {
          fetch(`${db}/book/` + idbox.value, {
            method: "DELETE",
          })
            .then((res) => res.json())
            .then((data) => {
              console.log("This is the Mongo ID Data - ", data);
              titlebox.value = "";
              authorbox.value = "";
              imagebox.value = "";
              descbox.value = "";
              genrebox.value = "";
              toastr.error("The book has been deleted.", "Deleted");
            });
        } catch (error) {
          console.log("Error in deleting data from MongoDB");
        }
      }

      //---------------Add Event Listener------------------------------------
      instBtn.addEventListener("click", InsertData);
      fetchBtn.addEventListener("click", fetchData);
      updateBtn.addEventListener("click", updateData);
      deleteBtn.addEventListener("click", deleteData);

      //----------Test Data-----------------------------------------------------
      // var listFoot = [];
      $(document).ready(function () {
        //Bug mongo
        // fetch("http://localhost:5000/api/books")
        fetch(`${db}/books`)
          .then((res) => res.json())
          .then((data) => {
            console.log(data);
            console.log(Object.keys(data));
            console.log(Object.values(data));

            const ul_footer_ = document.createElement("ul");
            ul_footer_.setAttribute("class", "footer-ul");
            ul_footer_.setAttribute("class", "list-group");
            const footer_ = document.getElementById("footer");
            footer_.appendChild(ul_footer_);

            data.forEach((element, key) => {
              console.log(element);

              const ali_ = document.createElement("a");
              // ali_.setAttribute("href", "#");
              // ali_.setAttribute("class", "list-group-item list-group-item-action");
              ali_.setAttribute("class", "lolz");
              ali_.setAttribute("id", element.id);

              const li_ = document.createElement("li");
              li_.setAttribute("class", "list-group-item");
              // li_.innerHTML = key + ". " + data[key].name;
              li_.innerHTML = data[key].id + ". " + data[key].name;
              // li.innerHTML = data[key].name;
              ali_.appendChild(li_);
              // ali_.setAttribute("id", key);
              // ali_.setAttribute("class", "lulz");
              ul_footer_.appendChild(ali_);
            });
            var listFoot_ = document.getElementsByClassName("lolz");
            listFoot_ = Array.from(listFoot_);
            listFoot_.forEach((item) => {
              item.addEventListener("click", () => fetchDataFoota(item));
            });
          })
          .catch((err) => console.log(err));

        const fetchDataFoota = (item) => {
          console.log(item.id);
          console.log(item.innerHTML);
          idbox.value = item.id;
          fetchData();
          //   //navigate to header
          window.location.href = "#header";
        };
      });
    </script>
    <!-- Bug 12 starts -->
    <!-- <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script> -->
    <!-- <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script> -->
    <!-- Bug 12 ends  -->
    <!-- Bug 14 -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script> -->
    <script src="/assets/toastr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/party-js@latest/bundle/party.min.js"></script>
    <!--Toastr-->
  </body>
</html>
